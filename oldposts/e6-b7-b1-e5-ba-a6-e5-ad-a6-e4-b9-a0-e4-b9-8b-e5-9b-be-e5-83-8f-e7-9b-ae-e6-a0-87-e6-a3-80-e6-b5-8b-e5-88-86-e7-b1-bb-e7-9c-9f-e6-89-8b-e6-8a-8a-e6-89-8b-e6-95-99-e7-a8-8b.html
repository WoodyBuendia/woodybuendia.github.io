<!DOCTYPE html>
<html lang="zh-Hans">
    <!-- title -->




<!-- keywords -->




<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" >
    <meta name="author" content="Woody Buendia">
    <meta name="renderer" content="webkit">
    <meta name="copyright" content="Woody Buendia">
    
    <meta name="keywords" content="hexo,hexo-theme,hexo-blog">
    
    <meta name="description" content="">
    <meta name="description" content="0.吐槽 本人python零基础（16年就买了py学习手册一直没看完），深度学习零基础（17年买的花书翻了三页纸），突发奇想（领导要求），上马深度学习图像分类，三天时间跑起来python识别图像并对图片内容进行识别和框选分类。 吐槽：都说Python编程简洁，python的宗旨是：优美胜于丑陋、明了胜于晦涩、简洁胜于复杂、复杂胜于凌乱…..可是python的安装和各种编译器、各种库、各种pip、p">
<meta property="og:type" content="website">
<meta property="og:title" content="深度学习之图像目标检测分类-真手把手教程">
<meta property="og:url" content="http://woodybuendia.site/oldposts/e6-b7-b1-e5-ba-a6-e5-ad-a6-e4-b9-a0-e4-b9-8b-e5-9b-be-e5-83-8f-e7-9b-ae-e6-a0-87-e6-a3-80-e6-b5-8b-e5-88-86-e7-b1-bb-e7-9c-9f-e6-89-8b-e6-8a-8a-e6-89-8b-e6-95-99-e7-a8-8b.html">
<meta property="og:site_name" content="WoodyBuendia">
<meta property="og:description" content="0.吐槽 本人python零基础（16年就买了py学习手册一直没看完），深度学习零基础（17年买的花书翻了三页纸），突发奇想（领导要求），上马深度学习图像分类，三天时间跑起来python识别图像并对图片内容进行识别和框选分类。 吐槽：都说Python编程简洁，python的宗旨是：优美胜于丑陋、明了胜于晦涩、简洁胜于复杂、复杂胜于凌乱…..可是python的安装和各种编译器、各种库、各种pip、p">
<meta property="og:image" content="http://woodybuendia.site/wp-content/uploads/2019/07/image.jpeg">
<meta property="og:image" content="http://woodybuendia.site/wp-content/uploads/2019/07/image-27-1024x504.png">
<meta property="og:image" content="http://woodybuendia.site/wp-content/uploads/2019/07/image-26-1024x423.png">
<meta property="og:image" content="http://woodybuendia.site/wp-content/uploads/2019/07/image-28-1024x616.png">
<meta property="og:image" content="http://woodybuendia.site/wp-content/uploads/2019/07/image-29-1024x476.png">
<meta property="og:image" content="http://woodybuendia.site/wp-content/uploads/2019/07/image-31-1024x229.png">
<meta property="og:image" content="http://woodybuendia.site/wp-content/uploads/2019/07/image-35-1024x582.png">
<meta property="og:image" content="http://woodybuendia.site/wp-content/uploads/2019/07/image-34-1024x237.png">
<meta property="og:image" content="http://woodybuendia.site/wp-content/uploads/2019/07/image-30-1024x554.png">
<meta property="og:image" content="http://woodybuendia.site/wp-content/uploads/2019/07/image-36-1024x460.png">
<meta property="og:image" content="http://woodybuendia.site/wp-content/uploads/2019/07/image-37-562x1024.png">
<meta property="og:image" content="http://woodybuendia.site/wp-content/uploads/2019/07/image-38-1024x447.png">
<meta property="og:image" content="http://woodybuendia.site/wp-content/uploads/2019/07/image-39-1024x386.png">
<meta property="og:image" content="http://woodybuendia.site/wp-content/uploads/2019/07/image-40-1024x598.png">
<meta property="og:image" content="http://woodybuendia.site/wp-content/uploads/2019/07/image-41-1024x136.png">
<meta property="og:image" content="http://woodybuendia.site/wp-content/uploads/2019/07/image-42-1024x447.png">
<meta property="og:image" content="http://woodybuendia.site/wp-content/uploads/2019/07/laiy-det.jpg">
<meta property="og:image" content="http://woodybuendia.site/wp-content/uploads/2019/07/oldman-det.jpg">
<meta property="article:published_time" content="2019-07-19T06:30:05.000Z">
<meta property="article:modified_time" content="2020-06-20T03:26:26.736Z">
<meta property="article:author" content="Woody Buendia">
<meta property="article:tag" content="python">
<meta property="article:tag" content="pytorch">
<meta property="article:tag" content="图像目标检测">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://woodybuendia.site/wp-content/uploads/2019/07/image.jpeg">
    <meta http-equiv="Cache-control" content="no-cache">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    
    <title>深度学习之图像目标检测分类-真手把手教程 · The Blog of WoodyBuendia</title>
    <style type="text/css">
    @font-face {
        font-family: 'Oswald-Regular';
        src: url("/font/Oswald-Regular.ttf");
    }

    body {
        margin: 0;
    }

    header,
    footer,
    .back-top,
    .sidebar,
    .container,
    .site-intro-meta,
    .toc-wrapper {
        display: none;
    }

    .site-intro {
        position: relative;
        z-index: 3;
        width: 100%;
        /* height: 50vh; */
        overflow: hidden;
    }

    .site-intro-placeholder {
        position: absolute;
        z-index: -2;
        top: 0;
        left: 0;
        width: calc(100% + 300px);
        height: 100%;
        background: repeating-linear-gradient(-45deg, #444 0, #444 80px, #333 80px, #333 160px);
        background-position: center center;
        transform: translate3d(-226px, 0, 0);
        animation: gradient-move 2.5s ease-out 0s infinite;
    }

    @keyframes gradient-move {
        0% {
            transform: translate3d(-226px, 0, 0);
        }
        100% {
            transform: translate3d(0, 0, 0);
        }
    }

</style>

    <link rel="preload" href= "/css/style.css?v=20180824" as="style" onload="this.onload=null;this.rel='stylesheet'" />
    <link rel="stylesheet" href= "/css/mobile.css?v=20180824" media="(max-width: 980px)">
    
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'" />
    
    <!-- /*! loadCSS. [c]2017 Filament Group, Inc. MIT License */
/* This file is meant as a standalone workflow for
- testing support for link[rel=preload]
- enabling async CSS loading in browsers that do not support rel=preload
- applying rel preload css once loaded, whether supported or not.
*/ -->
<script>
(function( w ){
	"use strict";
	// rel=preload support test
	if( !w.loadCSS ){
		w.loadCSS = function(){};
	}
	// define on the loadCSS obj
	var rp = loadCSS.relpreload = {};
	// rel=preload feature support test
	// runs once and returns a function for compat purposes
	rp.support = (function(){
		var ret;
		try {
			ret = w.document.createElement( "link" ).relList.supports( "preload" );
		} catch (e) {
			ret = false;
		}
		return function(){
			return ret;
		};
	})();

	// if preload isn't supported, get an asynchronous load by using a non-matching media attribute
	// then change that media back to its intended value on load
	rp.bindMediaToggle = function( link ){
		// remember existing media attr for ultimate state, or default to 'all'
		var finalMedia = link.media || "all";

		function enableStylesheet(){
			link.media = finalMedia;
		}

		// bind load handlers to enable media
		if( link.addEventListener ){
			link.addEventListener( "load", enableStylesheet );
		} else if( link.attachEvent ){
			link.attachEvent( "onload", enableStylesheet );
		}

		// Set rel and non-applicable media type to start an async request
		// note: timeout allows this to happen async to let rendering continue in IE
		setTimeout(function(){
			link.rel = "stylesheet";
			link.media = "only x";
		});
		// also enable media after 3 seconds,
		// which will catch very old browsers (android 2.x, old firefox) that don't support onload on link
		setTimeout( enableStylesheet, 3000 );
	};

	// loop through link elements in DOM
	rp.poly = function(){
		// double check this to prevent external calls from running
		if( rp.support() ){
			return;
		}
		var links = w.document.getElementsByTagName( "link" );
		for( var i = 0; i < links.length; i++ ){
			var link = links[ i ];
			// qualify links to those with rel=preload and as=style attrs
			if( link.rel === "preload" && link.getAttribute( "as" ) === "style" && !link.getAttribute( "data-loadcss" ) ){
				// prevent rerunning on link
				link.setAttribute( "data-loadcss", true );
				// bind listeners to toggle media back
				rp.bindMediaToggle( link );
			}
		}
	};

	// if unsupported, run the polyfill
	if( !rp.support() ){
		// run once at least
		rp.poly();

		// rerun poly on an interval until onload
		var run = w.setInterval( rp.poly, 500 );
		if( w.addEventListener ){
			w.addEventListener( "load", function(){
				rp.poly();
				w.clearInterval( run );
			} );
		} else if( w.attachEvent ){
			w.attachEvent( "onload", function(){
				rp.poly();
				w.clearInterval( run );
			} );
		}
	}


	// commonjs
	if( typeof exports !== "undefined" ){
		exports.loadCSS = loadCSS;
	}
	else {
		w.loadCSS = loadCSS;
	}
}( typeof global !== "undefined" ? global : this ) );
</script>

    <link rel="icon" href= "/assets/favicon.ico" />
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/webfontloader@1.6.28/webfontloader.min.js" as="script" />
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js" as="script" />
    <link rel="preload" href="/scripts/main.js" as="script" />
    <link rel="preload" as="font" href="/font/Oswald-Regular.ttf" crossorigin>
    <link rel="preload" as="font" href="https://at.alicdn.com/t/font_327081_1dta1rlogw17zaor.woff" crossorigin>
    
    <!-- fancybox -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" defer></script>
    <!-- 百度统计  -->
    
    <!-- 谷歌统计  -->
    
<meta name="generator" content="Hexo 4.2.1"></head>

    
    
<header class="header">

    <div class="read-progress"></div>
    <div class="header-sidebar-menu">&#xe775;</div>
    <!-- post页的toggle banner  -->
    
    <a class="home-link" href=/>The Blog of WoodyBuendia.</a>
</header>
    <div class="wrapper">
        <div class="site-intro" style="






">
    
    <!-- 主页  -->
            
    <div class="site-intro-placeholder"></div>
    <div class="site-intro-img" style="background-image: url(/)"></div>
    <div class="site-intro-meta">
        <!-- 标题  -->
        <h1 class="intro-title">
            <!-- 主页  -->
            
        </h1>
        <!-- 副标题 -->
        <p class="intro-subtitle">
            <!-- 主页副标题  -->
            
        </p>
        <!-- 文章页meta -->
        
    </div>
</div>
        <script>
 
  // get user agent
  var browser = {
    versions: function () {
      var u = window.navigator.userAgent;
      return {
        userAgent: u,
        trident: u.indexOf('Trident') > -1, //IE内核
        presto: u.indexOf('Presto') > -1, //opera内核
        webKit: u.indexOf('AppleWebKit') > -1, //苹果、谷歌内核
        gecko: u.indexOf('Gecko') > -1 && u.indexOf('KHTML') == -1, //火狐内核
        mobile: !!u.match(/AppleWebKit.*Mobile.*/), //是否为移动终端
        ios: !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/), //ios终端
        android: u.indexOf('Android') > -1 || u.indexOf('Linux') > -1, //android终端或者uc浏览器
        iPhone: u.indexOf('iPhone') > -1 || u.indexOf('Mac') > -1, //是否为iPhone或者安卓QQ浏览器
        iPad: u.indexOf('iPad') > -1, //是否为iPad
        webApp: u.indexOf('Safari') == -1, //是否为web应用程序，没有头部与底部
        weixin: u.indexOf('MicroMessenger') == -1, //是否为微信浏览器
        uc: u.indexOf('UCBrowser') > -1 //是否为android下的UC浏览器
      };
    }()
  }
  console.log("userAgent:" + browser.versions.userAgent);

  // callback
  function fontLoaded() {
    console.log('font loaded');
    if (document.getElementsByClassName('site-intro-meta')) {
      document.getElementsByClassName('intro-title')[0].classList.add('intro-fade-in');
      document.getElementsByClassName('intro-subtitle')[0].classList.add('intro-fade-in');
      var postIntros = document.getElementsByClassName('post-intros')[0]
      if (postIntros) {
        postIntros.classList.add('post-fade-in');
      }
    }
  }

  // UC不支持跨域，所以直接显示
  function asyncCb(){
    if (browser.versions.uc) {
      console.log("UCBrowser");
      fontLoaded();
    } else {
      WebFont.load({
        custom: {
          families: ['Oswald-Regular']
        },
        loading: function () {  //所有字体开始加载
          // console.log('loading');
        },
        active: function () {  //所有字体已渲染
          fontLoaded();
        },
        inactive: function () { //字体预加载失败，无效字体或浏览器不支持加载
          console.log('inactive: timeout');
          fontLoaded();
        },
        timeout: 5000 // Set the timeout to two seconds
      });
    }
  }

  function asyncErr(){
    console.warn('script load from CDN failed, will load local script')
  }

  // load webfont-loader async, and add callback function
  function async(u, cb, err) {
    var d = document, t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
    o.src = u;
    if (cb) { o.addEventListener('load', function (e) { cb(null, e); }, false); }
    if (err) { o.addEventListener('error', function (e) { err(null, e); }, false); }
    s.parentNode.insertBefore(o, s);
  }

  var asyncLoadWithFallBack = function(arr, success, reject) {
      var currReject = function(){
        reject()
        arr.shift()
        if(arr.length)
          async(arr[0], success, currReject)
        }

      async(arr[0], success, currReject)
  }

  asyncLoadWithFallBack([
    "https://cdn.jsdelivr.net/npm/webfontloader@1.6.28/webfontloader.min.js", 
    "https://cdn.bootcss.com/webfont/1.6.28/webfontloader.js",
    "/lib/webfontloader.min.js"
  ], asyncCb, asyncErr)
</script>        
        <img class="loading" src="/assets/loading.svg" style="display: block; margin: 6rem auto 0 auto; width: 6rem; height: 6rem;" />
        <div class="container container-unloaded">
            <main class="main post-page">
    <article class="article-entry">
        <p><strong>0.吐槽</strong></p>
<p>本人python零基础（16年就买了py学习手册一直没看完），深度学习零基础（17年买的花书翻了三页纸），突发奇想（领导要求），上马深度学习图像分类，三天时间跑起来python识别图像并对图片内容进行识别和框选分类。</p>
<p>吐槽：都说Python编程简洁，python的宗旨是：<strong>优美胜于丑陋、明了胜于晦涩、简洁胜于复杂、复杂胜于凌乱</strong>…..可是python的安装和各种编译器、各种库、各种pip、pip3、conda、wheel完全就把我弄昏了头。好不容易装起来了，又是各种路径、环境、配置乱七八糟各种问题，日了狗了。。真还不如MATLAB来的简单。。。好了吐槽归吐槽，本文让你从小白到运行py如飞。</p>
<h2 id="1-清单"><a href="#1-清单" class="headerlink" title="1.清单"></a>1.清单</h2><p><img src="http://woodybuendia.site/wp-content/uploads/2019/07/image.jpeg" alt=""></p>
<p>为避免文章冗长无章，先把所需清单和背景知识列举一下。</p>
<p>关键参考文献：<a href="https://towardsdatascience.com/object-detection-and-tracking-in-pytorch-b3cf1a696a98" target="_blank" rel="noopener">Object detection and tracking in PyTorch</a>，原作者简介： <em>Chris Fotache is an AI researcher with <em>[</em>CYNET.ai_](<a href="http://www.cynet.ai/" target="_blank" rel="noopener">http://www.cynet.ai/</a>)</em> based in New Jersey. He covers topics related to artificial intelligence in our life, Python programming, machine learning, computer vision, natural language processing and more._</p>
<p>该文章中英文对照 <strong><a href="https://ai.yanxishe.com/page/TextTranslation/1333" target="_blank" rel="noopener">用PyTorch来做物体检测和追踪</a></strong><a href="https://ai.yanxishe.com/page/TextTranslation/1333" target="_blank" rel="noopener"></a></p>
<p>所需软件：python3.7、Anaconda</p>
<p>本来用的是PyCharm作为编辑器，Anaconda为python库环境，但是PyCharm使用的时候总是遇到问题，后面在Anaconda里面也找到了python的命令行窗口，总算把程序跑起来了。</p>
<p>运行平台：windows 10</p>
<h2 id="2-安装和下载"><a href="#2-安装和下载" class="headerlink" title="2.安装和下载"></a>2.安装和下载</h2><h3 id="2-1-安装python"><a href="#2-1-安装python" class="headerlink" title="2.1 安装python"></a>2.1 安装python</h3><p>打开python官网，下载win平台最新版3.7，</p>
<p><a href="https://www.python.org/downloads/windows/" target="_blank" rel="noopener">https://www.python.org/downloads/windows/</a></p>
<p><img src="http://woodybuendia.site/wp-content/uploads/2019/07/image-27-1024x504.png" alt=""></p>
<p>安装python，需要注意的是，勾选添加至系统路径。</p>
<h3 id="2-2-安装anaconda"><a href="#2-2-安装anaconda" class="headerlink" title="2.2 安装anaconda"></a>2.2 安装anaconda</h3><p>Anaconda安装文件较大，下载安装。Anaconda 是一个管理python的库的平台，众所周知，python之所以强大，是因为有各种库。需要什么功能，首先寻找有没有库，这也导致了python的库版本众多，管理困难，开发环境混乱。</p>
<p><a href="https://www.anaconda.com/distribution/" target="_blank" rel="noopener">https://www.anaconda.com/distribution/</a></p>
<p>下载链接</p>
<p><img src="http://woodybuendia.site/wp-content/uploads/2019/07/image-26-1024x423.png" alt=""></p>
<h3 id="2-3-下载文件"><a href="#2-3-下载文件" class="headerlink" title="2.3 下载文件"></a>2.3 下载文件</h3><p>根据 参考文献：<a href="https://towardsdatascience.com/object-detection-and-tracking-in-pytorch-b3cf1a696a98" target="_blank" rel="noopener">Object detection and tracking in PyTorch</a>， 下载所需文件，下载地址为GitHub：<a href="https://github.com/cfotache/pytorch_objectdetecttrack" target="_blank" rel="noopener">https://github.com/cfotache/pytorch_objectdetecttrack</a></p>
<p><img src="http://woodybuendia.site/wp-content/uploads/2019/07/image-28-1024x616.png" alt=""></p>
<p>下载权重文件 yolov3.weights （236MB）， 将该文件放入config文件夹中，下载地址：<a href="https://pjreddie.com/media/files/yolov3.weights" target="_blank" rel="noopener">https://pjreddie.com/media/files/yolov3.weights</a></p>
<p><img src="http://woodybuendia.site/wp-content/uploads/2019/07/image-29-1024x476.png" alt=""></p>
<h3 id="2-4-安装python库"><a href="#2-4-安装python库" class="headerlink" title="2.4 安装python库"></a>2.4 安装python库</h3><p>所需库：pytorch、opencv、matplotlib</p>
<p>运行Anaconda Prompt</p>
<p><img src="http://woodybuendia.site/wp-content/uploads/2019/07/image-31-1024x229.png" alt=""></p>
<p>在Pytorch官网选择自己的版本和平台，找到相应安装的命令。</p>
<p><a href="https://pytorch.org/" target="_blank" rel="noopener">https://pytorch.org/</a></p>
<p><img src="http://woodybuendia.site/wp-content/uploads/2019/07/image-35-1024x582.png" alt=""></p>
<p>我这里选择python3.7 ，conda安装，无CPU版。</p>
<p>在打开的 Anaconda Prompt 中输入下面命令安装pytorch</p>
<pre><code>conda install pytorch-cpu torchvision-cpu -c pytorch</code></pre><p><img src="http://woodybuendia.site/wp-content/uploads/2019/07/image-34-1024x237.png" alt=""></p>
<p>在Anaconda Prompt中输入：<code>conda install matplotlib</code>安装matplot库</p>
<p>打开Anaconda Navigator</p>
<p><img src="http://woodybuendia.site/wp-content/uploads/2019/07/image-30-1024x554.png" alt=""></p>
<p>左侧选择Environment</p>
<p><img src="http://woodybuendia.site/wp-content/uploads/2019/07/image-36-1024x460.png" alt=""></p>
<p>搜索opencv，会出来三个，勾选后点击右下角的apply安装。</p>
<p>注意：如果勾选后选择安装出现错误，那么在creat中新建一个环境</p>
<p><img src="http://woodybuendia.site/wp-content/uploads/2019/07/image-37-562x1024.png" alt=""></p>
<p><img src="http://woodybuendia.site/wp-content/uploads/2019/07/image-38-1024x447.png" alt=""></p>
<p>我的就报错了，新建了一个名为opencv的环境，注意，这个环境与默认的base环境是独立的，之前安装的pytorch和matplot都还需要在安装一边。</p>
<p>由于anaconda环境不同，在anaconda prompt中，输入：</p>
<pre><code>activate opencv (此处是你新建的环境名称)</code></pre><p>切换到新环境之后，重新安装 pytorch和matplot</p>
<p><img src="http://woodybuendia.site/wp-content/uploads/2019/07/image-39-1024x386.png" alt=""></p>
<h2 id="3-物体检测代码Object-Detection-in-Images"><a href="#3-物体检测代码Object-Detection-in-Images" class="headerlink" title="3 物体检测代码Object Detection in Images"></a>3 物体检测代码Object Detection in Images</h2><p>在从GitHub下载到的文件夹，名为：pytorch_objectdetecttrack-master，中新建python脚本：test.py</p>
<h3 id="3-1脚本"><a href="#3-1脚本" class="headerlink" title="3.1脚本"></a>3.1脚本</h3><p>输入以下代码：</p>
<pre><code>from models import *
from utils import *
import os, sys, time, datetime, random
import torch
from torch.utils.data import DataLoader
from torchvision import datasets, transforms
from torch.autograd import Variable
import matplotlib.pyplot as plt
import matplotlib.patches as patches
from PIL import Image

config_path=&apos;config/yolov3.cfg&apos;
weights_path=&apos;config/yolov3.weights&apos;
class_path=&apos;config/coco.names&apos;
img_size=416
conf_thres=0.8
nms_thres=0.4
# Load model and weights
model = Darknet(config_path, img_size=img_size)
model.load_weights(weights_path)
model.cuda()
#model.cpu()

model.eval()
classes = utils.load_classes(class_path)
Tensor = torch.cuda.FloatTensor

def detect_image(img):
    # scale and pad image
    ratio = min(img_size/img.size[0], img_size/img.size[1])
    imw = round(img.size[0] * ratio)
    imh = round(img.size[1] * ratio)
    img_transforms=transforms.Compose([transforms.Resize((imh,imw)),
         transforms.Pad((max(int((imh-imw)/2),0),
              max(int((imw-imh)/2),0), max(int((imh-imw)/2),0),
              max(int((imw-imh)/2),0)), (128,128,128)),
         transforms.ToTensor(),
         ])
    # convert image to Tensor
    image_tensor = img_transforms(img).float()
    image_tensor = image_tensor.unsqueeze_(0)
    input_img = Variable(image_tensor.type(Tensor))
    # run inference on the model and get detections
    with torch.no_grad():
        detections = model(input_img)
        detections = utils.non_max_suppression(detections, 80,
                        conf_thres, nms_thres)
    return detections[0]

# load image and get detections
img_path = &quot;images/blueangels.jpg&quot;

prev_time = time.time()
img = Image.open(img_path)
detections = detect_image(img)
inference_time = datetime.timedelta(seconds=time.time() - prev_time)
print (&apos;Inference Time: %s&apos; % (inference_time))
# Get bounding-box colors
cmap = plt.get_cmap(&apos;tab20b&apos;)
colors = [cmap(i) for i in np.linspace(0, 1, 20)]
img = np.array(img)
plt.figure()
fig, ax = plt.subplots(1, figsize=(12,9))
ax.imshow(img)
pad_x = max(img.shape[0] - img.shape[1], 0) * (img_size / max(img.shape))
pad_y = max(img.shape[1] - img.shape[0], 0) * (img_size / max(img.shape))
unpad_h = img_size - pad_y
unpad_w = img_size - pad_x
if detections is not None:
    unique_labels = detections[:, -1].cpu().unique()
    n_cls_preds = len(unique_labels)
    bbox_colors = random.sample(colors, n_cls_preds)
    # browse detections and draw bounding boxes
    for x1, y1, x2, y2, conf, cls_conf, cls_pred in detections:
        box_h = ((y2 - y1) / unpad_h) * img.shape[0]
        box_w = ((x2 - x1) / unpad_w) * img.shape[1]
        y1 = ((y1 - pad_y // 2) / unpad_h) * img.shape[0]
        x1 = ((x1 - pad_x // 2) / unpad_w) * img.shape[1]
        color = bbox_colors[int(np.where(
             unique_labels == int(cls_pred))[0])]
        bbox = patches.Rectangle((x1, y1), box_w, box_h,
             linewidth=2, edgecolor=color, facecolor=&apos;none&apos;)
        ax.add_patch(bbox)
        plt.text(x1, y1, s=classes[int(cls_pred)],
                color=&apos;white&apos;, verticalalignment=&apos;top&apos;,
                bbox={&apos;color&apos;: color, &apos;pad&apos;: 0})
plt.axis(&apos;off&apos;)
# save image
plt.savefig(img_path.replace(&quot;.jpg&quot;, &quot;-det.jpg&quot;),
                  bbox_inches=&apos;tight&apos;, pad_inches=0.0)
plt.show()</code></pre><h3 id="3-2-运行python"><a href="#3-2-运行python" class="headerlink" title="3.2 运行python"></a>3.2 运行python</h3><p>在打开的Anaconda Navigator中，选择环境，点击三角形箭头，在菜单中选择open with python</p>
<p><img src="http://woodybuendia.site/wp-content/uploads/2019/07/image-40-1024x598.png" alt=""></p>
<p>输入import torch，导入模块；</p>
<p>输入torch.cuda.is_available()，测试计算机是否有显卡。</p>
<p><strong>讲道理pytorch是支持无显卡，纯CPU模式的，但是需要改代码，我不会，下载到的这个代码是GPU模式的。。好在我的笔记本有显卡，虽然很破，但是不会报错。另外，一般讲道理这里不应该通过anaconda来运行python的，而是通过PyCharm来编辑py代码和运行的。但是我的pycharm运行显卡测试时，总是Fase，换成anaconda打开的python，就显示Ture。这可能和笔记本的独显和集显有关。</strong></p>
<p><img src="http://woodybuendia.site/wp-content/uploads/2019/07/image-41-1024x136.png" alt=""></p>
<h3 id="3-3切换工作目录"><a href="#3-3切换工作目录" class="headerlink" title="3.3切换工作目录"></a>3.3切换工作目录</h3><p>把通过anaconda启动的python命令行的工作目录切换到保存pytorch_objectdetecttrack-master的目录</p>
<p>输入：import os</p>
<p>输入：os.getcwd() 获取当前工作目录</p>
<p>输入os.chdir(‘’) 改变工作目录，我这里输入</p>
<pre><code>import os
os.chdir(&apos;D:/Python/pytorch_objectdetecttrack-master/pytorch_objectdetecttrack-master/&apos;)</code></pre><h3 id="3-4运行代码"><a href="#3-4运行代码" class="headerlink" title="3.4运行代码"></a>3.4运行代码</h3><p>在命令行输入：exec(open(‘test.py’).read()) 来执行test.py，即可检测图片中的物体。</p>
<p><img src="http://woodybuendia.site/wp-content/uploads/2019/07/image-42-1024x447.png" alt=""></p>
<h2 id="4效果"><a href="#4效果" class="headerlink" title="4效果"></a>4效果</h2><p><img src="http://woodybuendia.site/wp-content/uploads/2019/07/laiy-det.jpg" alt=""></p>
<p><img src="http://woodybuendia.site/wp-content/uploads/2019/07/oldman-det.jpg" alt=""></p>

    </article>
    <!-- license  -->
    
        <div class="license-wrapper">
            <p>原文作者：<a href="http://woodybuendia.site">Woody Buendia</a>
            <p>原文链接：<a href="http://woodybuendia.site/oldposts/e6-b7-b1-e5-ba-a6-e5-ad-a6-e4-b9-a0-e4-b9-8b-e5-9b-be-e5-83-8f-e7-9b-ae-e6-a0-87-e6-a3-80-e6-b5-8b-e5-88-86-e7-b1-bb-e7-9c-9f-e6-89-8b-e6-8a-8a-e6-89-8b-e6-95-99-e7-a8-8b.html">http://woodybuendia.site/oldposts/e6-b7-b1-e5-ba-a6-e5-ad-a6-e4-b9-a0-e4-b9-8b-e5-9b-be-e5-83-8f-e7-9b-ae-e6-a0-87-e6-a3-80-e6-b5-8b-e5-88-86-e7-b1-bb-e7-9c-9f-e6-89-8b-e6-8a-8a-e6-89-8b-e6-95-99-e7-a8-8b.html</a>
            <p>发表日期：<a href="http://woodybuendia.site/oldposts/e6-b7-b1-e5-ba-a6-e5-ad-a6-e4-b9-a0-e4-b9-8b-e5-9b-be-e5-83-8f-e7-9b-ae-e6-a0-87-e6-a3-80-e6-b5-8b-e5-88-86-e7-b1-bb-e7-9c-9f-e6-89-8b-e6-8a-8a-e6-89-8b-e6-95-99-e7-a8-8b.html">July 19th 2019, 2:30:05 pm</a>
            <p>更新日期：<a href="http://woodybuendia.site/oldposts/e6-b7-b1-e5-ba-a6-e5-ad-a6-e4-b9-a0-e4-b9-8b-e5-9b-be-e5-83-8f-e7-9b-ae-e6-a0-87-e6-a3-80-e6-b5-8b-e5-88-86-e7-b1-bb-e7-9c-9f-e6-89-8b-e6-8a-8a-e6-89-8b-e6-95-99-e7-a8-8b.html">June 20th 2020, 11:26:26 am</a>
            <p>版权声明：本文采用<a rel="license noopener" href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank">知识共享署名-非商业性使用 4.0 国际许可协议</a>进行许可</p>
        </div>
    
    <!-- paginator  -->
    <ul class="post-paginator">
        <li class="next">
            
        </li>
        <li class="previous">
            
        </li>
    </ul>
    <!-- 评论插件 -->
    <!-- 来必力City版安装代码 -->

<!-- City版安装代码已完成 -->
    
    
    <!-- gitalk评论 -->

    <!-- utteranc评论 -->

    <!-- partial('_partial/comment/changyan') -->
    <!--PC版-->


    
    

    <!-- 评论 -->
</main>
            <!-- profile -->
            
        </div>
        <footer class="footer footer-unloaded">
    <!-- social  -->
    
    <div class="social">
        
    
        
            
                <a href="mailto:tinywoody@126.com" class="iconfont-archer email" title=email ></a>
            
        
    
        
            
                <a href="//github.com/WoodyBuendia" class="iconfont-archer github" target="_blank" title=github></a>
            
        
    
        
            
                <span class="iconfont-archer wechat" title=wechat>
                  
                  <img class="profile-qr" src="/assets/example_qr.png" />
                </span>
            
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    

    </div>
    
    <!-- powered by Hexo  -->
    <div class="copyright">
        <span id="hexo-power">Powered by <a href="https://hexo.io/" target="_blank">Hexo</a></span><span class="iconfont-archer power">&#xe635;</span><span id="theme-info">theme <a href="https://github.com/fi3ework/hexo-theme-archer" target="_blank">Archer</a></span>
    </div>
    <!-- 不蒜子  -->
    
    <div class="busuanzi-container">
    
     
    <span id="busuanzi_container_site_pv">PV: <span id="busuanzi_value_site_pv"></span> :)</span>
    
    </div>
    
</footer>
    </div>
    <!-- toc -->
    
    <div class="back-top iconfont-archer">&#xe639;</div>
    <div class="sidebar sidebar-hide">
    <ul class="sidebar-tabs sidebar-tabs-active-0">
        <li class="sidebar-tab-archives"><span class="iconfont-archer">&#xe67d;</span><span class="tab-name">Archive</span></li>
        <li class="sidebar-tab-tags"><span class="iconfont-archer">&#xe61b;</span><span class="tab-name">Tag</span></li>
        <li class="sidebar-tab-categories"><span class="iconfont-archer">&#xe666;</span><span class="tab-name">Cate</span></li>
    </ul>
    <div class="sidebar-content sidebar-content-show-archive">
          <div class="sidebar-panel-archives">
    <!-- 在ejs中将archive按照时间排序 -->
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <div class="total-and-search">
        <div class="total-archive">
        Total : 26
        </div>
        <!-- search  -->
        
    </div>
    
    <div class="post-archive">
    
    
    
    
    <div class="archive-year"> 2020 </div>
    <ul class="year-list">
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">04/21</span><a class="archive-post-title" href= "/posts/c519e138/" >网站公告：倒计时68天迁移或关站</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">02/23</span><a class="archive-post-title" href= "/posts/8b9dd0b3/" >【MATLAB HFSS API】遇到问题该如何解决</a>
        </li>
    
    
    
    
    
        </ul>
    
    <div class="archive-year"> 2019 </div>
    <ul class="year-list">
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">11/23</span><a class="archive-post-title" href= "/posts/a591c053/" >【解决办法】win10华硕笔记本音频服务未响应或者播放失败请切换输出设备</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">11/07</span><a class="archive-post-title" href= "/posts/ee19aabb/" >天线阵列旁瓣的抑制</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">11/07</span><a class="archive-post-title" href= "/posts/af6469da/" >我的第一个Pyhton程序：通过百度地图API自动查询路况</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">09/04</span><a class="archive-post-title" href= "/posts/f85a11f2/" >杂谈-读书</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">08/19</span><a class="archive-post-title" href= "/posts/cbc78bbc/" >常用电磁仿真软件</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">07/19</span><a class="archive-post-title" href= "/posts/3cbee947/" >深度学习之图像目标检测分类-真手把手教程</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">07/18</span><a class="archive-post-title" href= "/posts/9686ac05/" >Antenna Magus Pro 2019 V9.2</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">07/18</span><a class="archive-post-title" href= "/posts/caf626e1/" >Ansys HFSS优化工具箱的使用：以耦合微带线电桥为例</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">07/18</span><a class="archive-post-title" href= "/posts/7ad379db/" >CST优化工具箱的使用-以分支线电桥的优化为例</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">07/15</span><a class="archive-post-title" href= "/posts/5d6c34a0/" >内网穿透frp部署记录总结</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">07/09</span><a class="archive-post-title" href= "/posts/e65408d4/" >网站维护记录</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">07/09</span><a class="archive-post-title" href= "/posts/f839a19a/" >CST Studio Suite 2019</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">07/02</span><a class="archive-post-title" href= "/posts/bb103e19/" >HFSS-MATLAB-API 使用教程</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">05/28</span><a class="archive-post-title" href= "/posts/cbe82740/" >建站记录</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">05/27</span><a class="archive-post-title" href= "/posts/95c7c80e/" >利用编程快速生成较大规模可重构阵列与编辑PIN二极管状态——Part Ⅰ:生成</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">05/24</span><a class="archive-post-title" href= "/posts/876c3924/" >【工作笔记】RFID系统工作原理与920MHz读卡器天线设计</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">05/23</span><a class="archive-post-title" href= "/posts/386efdff/" >毫米波无线通信英文原版《MillimeterWaveWirelessCommunications》</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">05/23</span><a class="archive-post-title" href= "/posts/e0bb75b4/" >PDF：Application Note of Radar Sensing and Detection_Innosent_调频连续波</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">05/22</span><a class="archive-post-title" href= "/posts/ac6f8e20/" >CST Studio 2018分布式计算(Distributed Computing)部署和破解</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">05/07</span><a class="archive-post-title" href= "/posts/dc7494f2/" >Antenna Magus Pro 8.0和CST 2018安装与破解</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">05/05</span><a class="archive-post-title" href= "/posts/b093272c/" >服务器远程桌面安装MATLAB出现License Manager Error -103的解决办法</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">04/05</span><a class="archive-post-title" href= "/posts/4123a0c2/" >二〇一九年四月五日·清明</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">03/07</span><a class="archive-post-title" href= "/posts/47beb6a6/" >电扫阵列：MATLAB 建模与仿真</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">03/07</span><a class="archive-post-title" href= "/posts/bbc48f3a/" >世界，您好！</a>
        </li>
    
    </div>
  </div>
        <div class="sidebar-panel-tags">
    <div class="sidebar-tags-name">
    
        <span class="sidebar-tag-name" data-tags="RFID"><span class="iconfont-archer">&#xe606;</span>RFID</span>
    
        <span class="sidebar-tag-name" data-tags="天线"><span class="iconfont-archer">&#xe606;</span>天线</span>
    
        <span class="sidebar-tag-name" data-tags="工作笔记"><span class="iconfont-archer">&#xe606;</span>工作笔记</span>
    
        <span class="sidebar-tag-name" data-tags="HFSS-Matlab API"><span class="iconfont-archer">&#xe606;</span>HFSS-Matlab API</span>
    
        <span class="sidebar-tag-name" data-tags="记录"><span class="iconfont-archer">&#xe606;</span>记录</span>
    
        <span class="sidebar-tag-name" data-tags="CST"><span class="iconfont-archer">&#xe606;</span>CST</span>
    
        <span class="sidebar-tag-name" data-tags="HFSS"><span class="iconfont-archer">&#xe606;</span>HFSS</span>
    
        <span class="sidebar-tag-name" data-tags="优化"><span class="iconfont-archer">&#xe606;</span>优化</span>
    
        <span class="sidebar-tag-name" data-tags="电桥"><span class="iconfont-archer">&#xe606;</span>电桥</span>
    
        <span class="sidebar-tag-name" data-tags="遗传算法"><span class="iconfont-archer">&#xe606;</span>遗传算法</span>
    
        <span class="sidebar-tag-name" data-tags="python"><span class="iconfont-archer">&#xe606;</span>python</span>
    
        <span class="sidebar-tag-name" data-tags="pytorch"><span class="iconfont-archer">&#xe606;</span>pytorch</span>
    
        <span class="sidebar-tag-name" data-tags="图像目标检测"><span class="iconfont-archer">&#xe606;</span>图像目标检测</span>
    
        <span class="sidebar-tag-name" data-tags="资源"><span class="iconfont-archer">&#xe606;</span>资源</span>
    
        <span class="sidebar-tag-name" data-tags="antenna magus"><span class="iconfont-archer">&#xe606;</span>antenna magus</span>
    
    </div>
    <div class="iconfont-archer sidebar-tags-empty">&#xe678;</div>
    <div class="tag-load-fail" style="display: none; color: #ccc; font-size: 0.6rem;">
    缺失模块。<br/>
    1、请确保node版本大于6.2<br/>
    2、在博客根目录（注意不是archer根目录）执行以下命令：<br/>
    <span style="color: #f75357; font-size: 1rem; line-height: 2rem;">npm i hexo-generator-json-content --save</span><br/>
    3、在根目录_config.yml里添加配置：
    <pre style="color: #787878; font-size: 0.6rem;">
jsonContent:
  meta: false
  pages: false
  posts:
    title: true
    date: true
    path: true
    text: false
    raw: false
    content: false
    slug: false
    updated: false
    comments: false
    link: false
    permalink: false
    excerpt: false
    categories: true
    tags: true</pre>
    </div> 
    <div class="sidebar-tags-list"></div>
</div>
        <div class="sidebar-panel-categories">
    <div class="sidebar-categories-name">
    
        <span class="sidebar-category-name" data-categories="未分类"><span class="iconfont-archer">&#xe60a;</span>未分类</span>
    
        <span class="sidebar-category-name" data-categories="资源"><span class="iconfont-archer">&#xe60a;</span>资源</span>
    
        <span class="sidebar-category-name" data-categories="天线与微波"><span class="iconfont-archer">&#xe60a;</span>天线与微波</span>
    
        <span class="sidebar-category-name" data-categories="MATLAB"><span class="iconfont-archer">&#xe60a;</span>MATLAB</span>
    
        <span class="sidebar-category-name" data-categories="随笔"><span class="iconfont-archer">&#xe60a;</span>随笔</span>
    
        <span class="sidebar-category-name" data-categories="计算机与互联网"><span class="iconfont-archer">&#xe60a;</span>计算机与互联网</span>
    
        <span class="sidebar-category-name" data-categories="MATLAB/天线与微波"><span class="iconfont-archer">&#xe60a;</span>MATLAB/天线与微波</span>
    
        <span class="sidebar-category-name" data-categories="天线与微波/资源"><span class="iconfont-archer">&#xe60a;</span>天线与微波/资源</span>
    
    </div>
    <div class="iconfont-archer sidebar-categories-empty">&#xe678;</div>
    <div class="sidebar-categories-list"></div>
</div>
    </div>
</div> 
    <script>
    var siteMeta = {
        root: "/",
        author: "Woody Buendia"
    }
</script>
    <!-- CDN failover -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
    <script type="text/javascript">
        if (typeof window.$ === 'undefined')
        {
            console.warn('jquery load from jsdelivr failed, will load local script')
            document.write('<script src="/lib/jquery.min.js">\x3C/script>')
        }
    </script>
    <script src="/scripts/main.js"></script>
    <!-- algolia -->
    
    <!-- busuanzi  -->
    
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    
    <!-- CNZZ  -->
    
    </div>
    <!-- async load share.js -->
     
    </body>
</html>


